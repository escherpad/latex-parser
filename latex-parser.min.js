!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["latex-parser"]=t():e["latex-parser"]=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,n){"use strict";function r(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{writable:!0,enumerable:!0,configurable:!0};if(!(e instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0!==t){if(!(t instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===r)r={writable:!0,enumerable:!0,configurable:!0};else if(!(r instanceof Object))throw new TypeError('"attributes" isn\'t an Object instance');if(void 0===n)for(var o in t)void 0!==t[o]&&Object.defineProperty(e,o,Object.create(r,{value:{value:t[o]}}));else if(n instanceof Array)n.forEach(function(n){void 0!==t[n]&&Object.defineProperty(e,n,Object.create(r,{value:{value:t[n]}}))});else{if(!(n instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var i in n){var a=n[i];void 0!==t[a]&&Object.defineProperty(e,i,Object.create(r,{value:{value:t[a]}}))}}}}function o(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!(e instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0===t)return!0;if(!(t instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===r&&(r=!0),void 0===n){for(var o in t)if(e[o]!==t[o]&&(void 0!==t[o]||!r))return!1}else{if(n instanceof Array)return n.every(function(n){return e[n]===t[n]||void 0===t[n]&&r});if(!(n instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var i in n){var a=n[i];if(e[i]!==t[a]&&(void 0!==t[a]||!r))return!1}}return!0}function i(e){return"number"==typeof e}function a(e){return"string"==typeof e}function s(e){if(!e)throw new Error;return e}Object.defineProperty(t,"__esModule",{value:!0}),t.updateProperties=r,t.testProperties=o,t.isNumber=i,t.isString=a,t.mustNotBeUndefined=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return c.hasOwnProperty(e)}function i(e){if(!o(e))throw new Error;return e}function a(e){return e&&e.hasOwnProperty("directive")&&e.hasOwnProperty("operand")}function s(e){if(!a(e))throw new Error;return e}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.isMode=o,t.mustBeMode=i,t.isOperationProperties=a,t.mustBeOperationProperties=s;var c=(t.Lexeme={BINARY_OPERATOR:"BINARY_OPERATOR",BRACKETS:"BRACKETS",CELL_SEPARATOR:"CELL_SEPARATOR",CHAR:"CHAR",DIGIT:"DIGIT",DIRECTIVE:"DIRECTIVE",DISPLAY_EQUATION:"DISPLAY_EQUATION",FILE_PATH:"FILE_PATH",FLOATING_BOX:"FLOATING_BOX",HORIZONTAL_SKIP:"HORIZONTAL_SKIP",INLINE_EQUATION:"INLINE_EQUATION",LABEL:"LABEL",LENGTH:"LENGTH",LETTER:"LETTER",LINE_BREAK:"LINE_BREAK",LIST_ITEM:"LIST_ITEM",LIST:"LIST",NUMBER:"NUMBER",PARAGRAPH_SEPARATOR:"PARAGRAPH_SEPARATOR",PICTURE:"PICTURE",POST_OPERATOR:"POST_OPERATOR",PRE_OPERATOR:"PRE_OPERATOR",RAW:"RAW",SPACE:"SPACE",SUBSCRIPT:"SUBSCRIPT",SUPERSCRIPT:"SUPERSCRIPT",TABLE:"TABLE",TABULAR_PARAMETERS:"TABULAR_PARAMETERS",TAG:"TAG",UNKNOWN:"UNKNOWN",VERTICAL_SKIP:"VERTICAL_SKIP",WORD:"WORD",WRAPPER:"WRAPPER"},t.modes={LIST:"LIST",MATH:"MATH",PICTURE:"PICTURE",TABLE:"TABLE",TEXT:"TEXT",VERTICAL:"VERTICAL"}),l=(t.State=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),Object.defineProperty(this,"modeStates_",{value:{},enumerable:!1}),this.modeStates_[c.LIST]=!1,this.modeStates_[c.MATH]=!1,this.modeStates_[c.PICTURE]=!1,this.modeStates_[c.TABLE]=!1,this.modeStates_[c.TEXT]=!0,this.modeStates_[c.VERTICAL]=!1,void 0!==t&&this.update(t)}return u(e,[{key:"copy",value:function(){return new e(this.modeStates_)}},{key:"update",value:function(e){for(var t in e){var n=c[i(t)];if(void 0===n)throw new TypeError('"modeStates['+t+"]\" isn't a Latex.Mode option");this.modeStates_[n]=e[t]}}},{key:"test",value:function(e){for(var t in e){var n=c[i(t)];if(void 0===n)throw new TypeError('"modeStates['+t+"]\" isn't a Latex.Mode option");if(this.modeStates_[n]!==e[t])return!1}return!0}}]),e}(),t.Directive={BEGIN:"BEGIN",END:"END"}),f=t.GROUP="GROUP";t.Operation=function(){function e(t){if(r(this,e),void 0!==t){if(!(t instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var n=l[t.directive];if(!n)throw new TypeError('"initialProperties.directive" isn\'t an Latex.Directive option');switch(Object.defineProperty(this,"directive",{value:n,enumerable:!0}),t.operand){case f:Object.defineProperty(this,"operand",{value:f,enumerable:!0});break;default:var o=c[t.operand];if(!o)throw new TypeError('"initialProperties.operand" isn\'t an Latex.Mode option');Object.defineProperty(this,"operand",{value:o,enumerable:!0})}}}return u(e,[{key:"equals",value:function(t){return t instanceof e&&(this.directive===t.directive&&this.operand===t.operand)}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return e.constructor===Array}function s(e){if(!a(e))throw new Error;return e}function u(e){return!0}function c(e){if(!u)throw new Error;return e}function l(e){return e instanceof T}function f(e){if(!l(e))throw new Error;return e}function p(e){return e instanceof P}Object.defineProperty(t,"__esModule",{value:!0}),t.Environment=t.Command=t.Symbol=t.Parameter=t.Item=t.LatexStyle=void 0;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.isParameterProperties=u,t.mustBeParameterProperties=c,t.isCommand=l,t.mustBeCommand=f,t.isEnvironment=p;var y=n(0),v=n(1),b=(t.LatexStyle=function(){function e(){i(this,e),this.symbols_={},this.commands_={},this.environments_={}}return m(e,[{key:"loadPackage",value:function(e,t){if(void 0!==t.symbols){if(!(t.symbols instanceof Array))throw new TypeError('"stylePackage.symbols" isn\'t an Array');for(var n=t.symbols.length-1;n>=0;--n){var r=new O(t.symbols[n]);if(r.pattern){var o=r.pattern[0];this.symbols_.hasOwnProperty(o)||(this.symbols_[o]=[]);this.symbols_[o].push({symbol:r,packageName:e})}}}if(void 0!==t.commands){if(!(t.commands instanceof Array))throw new TypeError('"stylePackage.commands" isn\'t an Array');for(var i=t.commands.length-1;i>=0;--i){var a=new T(t.commands[i]);a.name&&(this.commands_[a.name]||(this.commands_[a.name]=[])).push({command:a,packageName:e})}}if(void 0!==t.environments){if(!(t.environments instanceof Array))throw new TypeError('"stylePackage.environments" isn\'t an Array');for(var s=t.environments.length-1;s>=0;--s){var u=new P(t.environments[s]),c=u.name;if(c){var l=this.environments_[c];void 0===l&&(l=[],this.environments_[c]=l),l.push({environment:u,packageName:e})}}}}},{key:"unloadPackage",value:function(e){for(var t in this.symbols_)if(this.symbols_.hasOwnProperty(t)){var n=s(this.symbols_[t]).filter(function(t){return t.packageName!==e});n.length?this.symbols_[t]=n:delete this.symbols_[t]}for(var r in this.commands_)if(this.commands_.hasOwnProperty(r)){var o=s(this.commands_[r]).filter(function(t){return t.packageName!==e});o.length?this.commands_[r]=o:delete this.commands_[r]}for(var i in this.environments_)if(this.environments_.hasOwnProperty(i)){var a=s(this.environments_[i]).filter(function(t){return t.packageName!==e});a.length?this.environments_[i]=a:delete this.environments_[i]}}},{key:"symbols",value:function(e,t){if(!(e instanceof v.State))throw new SyntaxError('"state" isn\'t a State instance');var n=this.symbols_[t];if(void 0===n)return[];for(var r=[],o=s(n).length-1;o>=0;--o){var i=n[o].symbol;e.test(i.modes)&&r.push(i)}return r}},{key:"commands",value:function(e,t){if(!(e instanceof v.State))throw new SyntaxError('"state" isn\'t a State instance');var n=this.commands_[t];if(!n)return[];for(var r=[],o=s(n).length-1;o>=0;--o){var i=n[o].command;e.test(i.modes)&&r.push(i)}return r}},{key:"environments",value:function(e,t){if(!(e instanceof v.State))throw new SyntaxError("state isn't State instance");var n=this.environments_[t];return n?s(n).filter(function(t){return e.test(t.modes)}):[]}}]),e}(),t.Item=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,e),void 0!==t){if(!(t instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');switch(t.lexeme){case void 0:case null:break;default:var n=v.Lexeme[t.lexeme];if(void 0===n)throw new TypeError('"initialProperties.lexeme" isn\'t a Lexeme option');Object.defineProperty(this,"lexeme",{value:n})}if(void 0!==t.modes){if(!(t.modes instanceof Object))throw new TypeError('"initialProperties.modes" isn\'t an Object instance');Object.defineProperty(this,"modes",{value:{}});for(var r in t.modes){var o=(0,v.mustBeMode)(r);if(void 0===o)throw new TypeError('"initialProperties.modes['+r+"]\" isn't a Mode option");Object.defineProperty(this.modes,o,{value:t.modes[r],enumerable:!0})}}}}return m(e,[{key:"equals",value:function(t){return t instanceof e&&(this.lexeme===t.lexeme&&(0,y.testProperties)(this.modes,t.modes,v.modes,!1))}}]),e}());Object.defineProperties(b.prototype,{lexeme:{value:void 0,enumerable:!0},modes:{value:{},enumerable:!0}});var _=t.Parameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===e)return r(n);if(void 0!==e.operations){if(!(e.operations instanceof Array))throw new TypeError('"initialProperties.operations" isn\'t an Array instance');Object.defineProperty(n,"operations_",{value:e.operations.map(function(e){return new v.Operation(e)})})}return n}return o(t,e),m(t,[{key:"equals",value:function(e){return e instanceof t&&(!!d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)&&(this.operations_.length===e.operations_.length&&this.operations_.every(function(t,n){return t.equals(e.operations_[n])})))}},{key:"operations",get:function(){return this.operations_.slice()}}]),t}(b);Object.defineProperties(_.prototype,{operations:{enumerable:!0}}),Object.defineProperties(_.prototype,{operations_:{value:[],enumerable:!1}});var O=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===e)return r(n);if(void 0!==e.operations){if(!(e.operations instanceof Array))throw new TypeError('"initialProperties.operations" isn\'t an Array instance');Object.defineProperty(n,"operations_",{value:e.operations.map(function(e){return new v.Operation((0,v.mustBeOperationProperties)(e))})})}if(void 0!==e.parameters){if(!(e.parameters instanceof Array))throw new TypeError('"initialProperties.parameters" isn\'t an Array instance');n.parameters_=e.parameters.map(function(e){return new _(c(e))})}if(void 0!==e.pattern){if("string"!=typeof e.pattern)throw new TypeError('"initialProperties.pattern" isn\'t a string');var o=e.pattern.match(/([ \t]+|#\d+|[^ \t#]+)/g);o&&(n.patternComponents_=o.map(function(e){switch(e[0]){case" ":case"\t":return;case"#":var t=Number(e.substring(1))-1;if(!n.parameters_[t])throw new TypeError('"initialProperties.pattern" contains the incorrect parameter number '+e.substring(1));return t;default:return e}}))}if(void 0!==e.html){if("string"!=typeof e.html)throw new TypeError('"initialProperties.html" isn\'t a string');Object.defineProperty(n,"html",{value:e.html,enumerable:!0})}return n}return o(t,e),m(t,[{key:"parameter",value:function(e){return this.parameters_[e]||void 0}},{key:"equals",value:function(e){return e instanceof t&&(!!d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)&&(this.operations_.length===e.operations_.length&&(!!this.operations_.every(function(t,n){return t.equals(e.operations_[n])})&&(this.parameters_.length===e.parameters_.length&&(!!this.parameters_.every(function(t,n){return t.equals(e.parameters_[n])})&&this.html===e.html)))))}},{key:"operations",get:function(){return this.operations_.slice()}},{key:"parameters",get:function(){return this.parameters_.slice()}},{key:"patternComponents",get:function(){return(0,y.mustNotBeUndefined)(this.patternComponents_.slice())}},{key:"pattern",get:function(){return this.patternComponents_.map(function(e){if((0,y.isNumber)(e))return"#"+(e+1);switch(void 0===e?"undefined":h(e)){case"string":return e;default:return" "}}).join("")}}]),t}(b);t.Symbol=O,Object.defineProperties(O.prototype,{operations:{enumerable:!0},parameters:{enumerable:!0},patternComponents:{enumerable:!0},pattern:{enumerable:!0}}),Object.defineProperties(O.prototype,{operations_:{value:[],enumerable:!1,writable:!0},parameters_:{value:[],enumerable:!1,writable:!0},patternComponents_:{value:[],enumerable:!1,writable:!0},html:{value:"",enumerable:!0,writable:!0}});var T=t.Command=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===e)return r(n);if(void 0!==e.name){if("string"!=typeof e.name)throw new TypeError('"initialProperties.name" isn\'t a string');Object.defineProperty(n,"name",{value:e.name})}return n}return o(t,e),m(t,[{key:"equals",value:function(e){return e instanceof t&&(!!d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)&&this.name===e.name)}}]),t}(O);Object.defineProperties(T.prototype,{name:{value:"",enumerable:!0}});var P=t.Environment=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===e)return r(n);if(void 0!==e.name){if("string"!=typeof e.name)throw new TypeError('"initialProperties.name" isn\'t a string');Object.defineProperty(n,"name",{value:e.name})}return n}return o(t,e),m(t,[{key:"equals",value:function(e){return e instanceof t&&(!!d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)&&this.name===e.name)}}]),t}(b);Object.defineProperties(P.prototype,{name:{value:"",enumerable:!0}})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return e&&e instanceof T}function s(e){if(!u(e))throw new Error;return e}function u(e){return e instanceof P}function c(e){if(a(e.beginCommandToken))return e.beginCommandToken}function l(e){if(a(e.endCommandToken))return e.endCommandToken}function f(e){if(e.environment&&(0,d.isEnvironment)(e.environment))return e.environment}Object.defineProperty(t,"__esModule",{value:!0}),t.SourceToken=t.SpaceToken=t.EnvironmentBodyToken=t.EnvironmentToken=t.CommandToken=t.ParameterToken=t.SymbolToken=t.Token=t.LatexTree=void 0;var p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)};t.isCommandToken=a,t.mustBeEnvironmentToken=s,t.isEnvironmentToken=u;var d=n(2),m=n(4),y=n(1),v=n(0),b=(t.LatexTree=function(e){function t(e,n){if(r(this,t),!(e instanceof b))throw new TypeError('"rootToken" isn\'t a Token instance');return o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return i(t,e),t}(m.SyntaxTree),t.Token=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r(this,t),void 0===e)var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));else{if(!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var i=Object.create(e);i.parentNode=e.parentToken,i.childNodes=e.childTokens;var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i))}return o(n)}return i(t,e),p(t,[{key:"toString",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0):"Token{"+h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0)+"}"}}]),t}(m.Node));Object.defineProperties(b.prototype,{lexeme:{value:void 0,enumerable:!0},parentNodeClass_:{value:b}});var _=t.SymbolToken=function(e){function t(e){if(r(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(e.symbol){if(!(e.symbol instanceof d.Symbol))throw new TypeError('"initialProperties.symbol" isn\'t a Symbol instance');Object.defineProperty(n,"symbol",{value:e.symbol,enumerable:!0})}else{if("string"!=typeof e.pattern)throw new TypeError('"initialProperties.pattern" isn\'t a string');Object.defineProperty(n,"pattern",{value:e.pattern})}return n}return i(t,e),p(t,[{key:"toString",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="",n=0,r=this.pattern,o=r.length,i=0;i<o;++i){var a=r[i];if("#"===a){++i;var s=this.childNode(n++);t+=s?s.toString(!0):"??"}else t+=a}return e?t:"SymbolToken"+(this.symbol?"":"[?]")+"{"+t+"}"}},{key:"lexeme",get:function(){return this.symbol?this.symbol.lexeme:void 0}},{key:"pattern",get:function(){return(0,v.mustNotBeUndefined)(this.symbol).pattern}}]),t}(b);Object.defineProperties(_.prototype,{symbol:{value:void 0,enumerable:!0}}),Object.defineProperties(_.prototype,{pattern:{enumerable:!0}});var O=t.ParameterToken=function(e){function t(e){if(r(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.hasBrackets||Object.defineProperty(n,"hasBrackets",{value:!1,enumerable:!0}),e.hasSpacePrefix&&Object.defineProperty(n,"hasSpacePrefix",{value:!0,enumerable:!0}),n}return i(t,e),p(t,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.hasSpacePrefix?" ":"";return n+=this.hasBrackets?"{"+h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0)+"}":h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0),e?n:"ParameterToken{"+n+"}"}},{key:"lexeme",get:function(){if(this.parameter&&this.parameter.lexeme)return this.parameter.lexeme}},{key:"parameter",get:function(){var e=this.parentNode,t=(0,v.mustNotBeUndefined)(e.symbol),n=e.childIndex(this);if(void 0!==e&&void 0!==n&&n>=0)return t.parameter(n)}}]),t}(b);Object.defineProperties(O.prototype,{hasBrackets:{value:!0,enumerable:!0},hasSpacePrefix:{value:!1,enumerable:!0},parentNodeClass_:{value:_}}),Object.defineProperties(O.prototype,{parameter:{enumerable:!0}});var T=t.CommandToken=function(e){function t(e){if(r(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var n=Object.create(e);if(e.command){if(!(e.command instanceof d.Command))throw new TypeError('"initialProperties.command" isn\'t a LatexStyle.Command instance');n.symbol=e.command;var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n))}else{if("string"!=typeof e.name)throw new TypeError('"initialProperties.name" isn\'t a string');n.pattern="";var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));Object.defineProperty(i,"name",{value:e.name})}return o(i)}return i(t,e),p(t,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n="\\"+this.name+h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0);return e?n:"CommandToken"+(this.command?"":"[?]")+"{"+n+"}"}},{key:"command",get:function(){return(0,d.mustBeCommand)(this.symbol)}},{key:"name",get:function(){return this.command.name}}]),t}(_);Object.defineProperties(T.prototype,{command:{enumerable:!0},name:{enumerable:!0}});var P=t.EnvironmentToken=function(e){function t(e){if(r(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!(e.environment instanceof d.Environment))throw new TypeError('"initialProperties.environment" isn\'t a LatexStyle.Environment instance');return Object.defineProperty(n,"environment",{value:e.environment,enumerable:!0}),n}return i(t,e),p(t,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.beginCommandToken,n=this.endCommandToken,r=this.bodyToken,o="\\begin{"+this.environment.name+"}";return o+=t?_.prototype.toString.call(t,!0):"??",o+=r?r.toString(!0):"??",o+="\\end{"+this.environment.name+"}",o+=n?_.prototype.toString.call(n,!0):"??",e?o:"EnvironmentToken{"+o+"}"}},{key:"lexeme",get:function(){return this.environment.lexeme}},{key:"beginCommandToken",get:function(){var e=this.childNode(0);return e instanceof T?e:void 0}},{key:"endCommandToken",get:function(){var e=this.childNode(2);return e instanceof T?e:void 0}},{key:"bodyToken",get:function(){var e=this.childNode(1);return e instanceof w?e:void 0}}]),t}(b);Object.defineProperties(P.prototype,{beginToken:{enumerable:!0},endToken:{enumerable:!0}});var w=t.EnvironmentBodyToken=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),p(t,[{key:"toString",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0):"EnvironmentBodyToken{"+h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toString",this).call(this,!0)+"}"}},{key:"environment",get:function(){return this.parentNode&&f(this.parentNode)}},{key:"environmentToken",get:function(){return this.parentNode&&s(this.parentNode)}},{key:"beginCommandToken",get:function(){return this.parentNode&&c(this.parentNode)}},{key:"endCommandToken",get:function(){return this.parentNode&&l(this.parentNode)}}]),t}(b);Object.defineProperties(w.prototype,{parentNodeClass_:{value:P}});var g=t.SpaceToken=function(e){function t(e){if(r(this,t),void 0===e){var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o(n)}if(!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(e.lineBreakCount){if(!isFinite(e.lineBreakCount)||e.lineBreakCount<0)throw new TypeError('"initialProperties.lineBreakCount" isn\'t a non-negative number');Object.defineProperty(n,"lineBreakCount",{value:e.lineBreakCount,enumerable:!0})}return o(n)}return i(t,e),p(t,[{key:"toString",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])switch(this.lineBreakCount){case 0:return" ";case 1:return"\n";default:return"\n\n"}else switch(this.lineBreakCount){case 0:return"SpaceToken{ }";case 1:return"SpaceToken{\n}";default:return"SpaceToken{\n\n}"}}},{key:"lexeme",get:function(){return this.lineBreakCount<=1?"SPACE":"PARAGRAPH_SEPARATOR"}}]),t}(b);Object.defineProperties(g.prototype,{lineBreakCount:{value:0,enumerable:!0}});t.SourceToken=function(e){function t(e){if(r(this,t),!(e instanceof Object))throw new TypeError('"initialProperties" isn\'t an Object instance');var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!y.Lexeme[e.lexeme])throw new TypeError('"initialProperties.lexeme" isn\'t known');if(Object.defineProperty(n,"lexeme",{value:e.lexeme,enumerable:!0}),"string"!=typeof e.source)throw new TypeError('"initialProperties.sources" isn\'t a string');return Object.defineProperty(n,"source",{value:e.source,enumerable:!0}),n}return i(t,e),p(t,[{key:"toString",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.source:"SourceToken["+this.lexeme+"]{"+this.source+"}"}}]),t}(b);t.default=m.SyntaxTree},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Node=t.SyntaxTree=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),s=(t.SyntaxTree=function e(t,n){if(o(this,e),!(t instanceof s))throw new TypeError('"rootNode" isn\'t a SyntaxTree.Node instance');if(t.parentNode)throw new TypeError('"rootNode" has a parent node');if(t.tree)throw new TypeError('"rootNode" is a tree root');if("string"!=typeof n)throw new TypeError('"sources" isn\'t a string');Object.defineProperty(this,"rootNode",{value:t,enumerable:!0}),Object.defineProperty(this,"source",{value:n,enumerable:!0}),Object.defineProperty(t,"tree",{value:this,enumerable:!0})},t.Node=function(){function e(t){if(o(this,e),void 0!==t){if(!(t instanceof Object))throw new TypeError("initialProperties isn't an Object instance");if(void 0!==t.childNodes){if(!(t.childNodes instanceof Array))throw new TypeError("initialProperties.childNodes isn't an Array instance");t.childNodes.forEach(this.insertChildSubtree,this)}var n=t.parentNode;if(void 0!==n){if(!n)throw new TypeError("initialProperties.parentNode isn't a SyntaxTree.Node instance");n.insertChildSubtree(this)}}}return i(e,[{key:"childNode",value:function(t){if((0,a.isNumber)(t))return this.childNodes_[t]||void 0;if(t instanceof e)return t.parentNode===this?t:void 0;throw new TypeError('"node" is neither a number nor a SyntaxTree.Node instance')}},{key:"childIndex",value:function(t){if((0,a.isNumber)(t))return this.childNodes_[t]?t:void 0;if(t instanceof e)return t.parentNode===this?this.childNodes_.indexOf(t):void 0;throw new TypeError('"node" is neither a number nor a SyntaxTree.Node instance')}},{key:"insertChildNode",value:function(t,n,r){if(!(t instanceof e))throw new TypeError('"node" isn\'t a SyntaxTree.Node instance');if(t.parentNode)throw new TypeError('"node" has a parent');if(t.tree)throw new TypeError('"node" is a tree root');if(t.childNodes_.length)throw new TypeError('"node" has child nodes');this.hasOwnProperty("childNodes_")||Object.defineProperty(this,"childNodes_",{value:[],configurable:!0}),void 0===n&&(n=this.childNodes_.length),void 0===r&&(r=0);var o=this.childNodes_.splice(n,r,t);Object.defineProperty(this,"subtreeSize",{value:this.subtreeSize+1,enumerable:!0,configurable:!0});for(var i=this.parentNode;i;i=i.parentNode)Object.defineProperty(i,"subtreeSize",{value:i.subtreeSize+1});if(Object.defineProperty(t,"parentNode",{value:this,enumerable:!0,configurable:!0}),o.length){Object.defineProperty(t,"childNodes_",{value:o,configurable:!0});var a=1;o.forEach(function(e){a+=e.subtreeSize}),Object.defineProperty(t,"subtreeSize",{value:a,enumerable:!0,configurable:!0})}return t}},{key:"insertChildSubtree",value:function(t,n){if(!(t instanceof e))throw new TypeError('"node" isn\'t a SyntaxTree.Node instance');if(t.parentNode)throw new TypeError('"node" has a parent');if(t.tree)throw new TypeError('"node" is a tree root');this.hasOwnProperty("childNodes_")||Object.defineProperty(this,"childNodes_",{value:[],configurable:!0}),void 0===n&&(n=this.childNodes_.length),this.childNodes_.splice(n,0,t);var r=t.subtreeSize;Object.defineProperty(this,"subtreeSize",{value:this.subtreeSize+r,enumerable:!0,configurable:!0});for(var o=this.parentNode;o;o=o.parentNode)Object.defineProperty(o,"subtreeSize",{value:o.subtreeSize+r});Object.defineProperty(t,"parentNode",{value:this,enumerable:!0,configurable:!0})}},{key:"removeChildNode",value:function(e){var t,n=this.childIndex(e);if(void 0!==n){var o=this.childNodes_[n];(t=this.childNodes_).splice.apply(t,[n,1].concat(r(o.childNodes_))),this.childNodes_.length?Object.defineProperty(this,"subtreeSize",{value:this.subtreeSize-1}):(delete this.childNodes_,delete this.subtreeSize);for(var i=this.parentNode;i;i=i.parentNode)Object.defineProperty(i,"subtreeSize",{value:i.subtreeSize-1});return delete o.parentNode,delete o.childNodes_,delete o.subtreeSize,o}}},{key:"removeChildSubtree",value:function(e){var t=this.childIndex(e);if(void 0!==t){e=this.childNodes_.splice(t,1)[0];var n=e.subtreeSize;this.childNodes_.length?Object.defineProperty(this,"subtreeSize",{value:this.subtreeSize-n}):(delete this.childNodes_,delete this.subtreeSize);for(var r=this.parentNode;r;r=r.parentNode)Object.defineProperty(r,"subtreeSize",{value:r.subtreeSize-n});return delete e.parentNode,e}}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="";return this.childNodes_.forEach(function(e){t+=e.toString(!0)}),e?t:"SourceTree.Node{"+t+"}"}},{key:"childNodes",get:function(){return this.childNodes_.slice()}}]),e}());Object.defineProperties(s.prototype,{childNodes:{enumerable:!0}}),Object.defineProperties(s.prototype,{tree:{value:void 0,enumerable:!0},parentNode:{value:void 0,enumerable:!0},subtreeSize:{value:1,enumerable:!0},childNodes_:{value:[],enumerable:!1},parentNodeClass_:{value:s,enumerable:!1}})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=e.source.substring(e.position).match(/^%([^\n]*)(\n[ \t]*)?/);return!!t&&(e.comments.push(t[1]),e.position+=t[0].length,t[2]?(++e.lineNumber,e.charNumber=t[2].length-1):e.charNumber+=t[0].length,!0)}function i(e,t){e.currentToken&&e.currentToken.insertChildSubtree(t)}function a(e){for(var t=!1,n=0;e.position<e.source.length;)if(!o(e)){switch(e.source[e.position]){case" ":case"\t":t=!0,++e.position,++e.charNumber;continue;case"\n":t=!0,++n,++e.position,++e.lineNumber,e.charNumber=0;continue}break}return t?new c.SpaceToken({lineBreakCount:n}):void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.Context=t.LatexParser=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),c=n(3),l=n(1),f=n(0),p=(t.LatexParser=function(){function e(t){if(r(this,e),!(t instanceof u.LatexStyle))throw new TypeError('"latexStyle" isn\'t a LatexStyle instance');Object.defineProperty(this,"latexStyle",{value:t,enumerable:!0})}return s(e,[{key:"parse",value:function(e,t){if("string"!=typeof e)throw new TypeError('"sources" isn\'t a string');var n=void 0;if(void 0===t)n=new p(e);else{if(!(t instanceof p))throw new TypeError('"context" isn\'t a LatexParser.Context instance');n=t,n.source+=e}for(var r=[];;){var o=this.parseToken_(n);if(void 0===o)break;r.push(o)}return r}},{key:"parseToken_",value:function(e){var t=a(e);if(!t){if(e.position>=e.source.length)return;var n=e.copy();if(!((t=this.parseEnvironmentToken_(e))||(n.copy(e),(t=this.parseCommandToken_(e))||(n.copy(e),t=this.parseSymbolsToken_(e)))))return}return i(e,t),t}},{key:"parseParameterToken_",value:function(e,t,n){var r=e.currentToken;if(e.updateState(t.operations),void 0===n){var o=void 0!==a(e);if("{"===e.source[e.position]){if(e.currentToken=new c.ParameterToken({hasBrackets:!0,hasSpacePrefix:o}),++e.position,++e.charNumber,!this.parseUntilLabel_(e,"}",t.lexeme))return;++e.position,++e.charNumber}else if(e.currentToken=new c.ParameterToken({hasBrackets:!1,hasSpacePrefix:o}),void 0===this.parseToken_(e))return}else if(e.currentToken=new c.ParameterToken({hasBrackets:!1,hasSpacePrefix:!1}),!this.parseUntilLabel_(e,n,t.lexeme))return;var s=e.currentToken;return e.currentToken=r,i(e,s),s}},{key:"parseEnvironmentToken_",value:function(e){if(0===e.source.substring(e.position).indexOf("\\begin")){e.position+=6,a(e);var t=e.source.substring(e.position).match(/^{([\w@]+\*?)}/);if(t){var n=t[1];e.position+=t[0].length,e.charNumber+=t[0].length;var r=e.currentToken,o=this.latexStyle.environments(e.currentState,n)[0],s=e.currentToken=o?new c.EnvironmentToken({environment:o.environment}):new c.EnvironmentToken({name:n}),u=this.latexStyle.commands(e.currentState,n),l=this.parsePatterns_(e,u);void 0===l&&(l=new c.CommandToken({name:n})),i(e,l);var f=e.currentToken=new c.EnvironmentBodyToken,p=this.parseUntilLabel_(e,"\\end{"+n+"}");e.currentToken=s,i(e,f);var h=void 0;return p&&(e.position+=n.length+6,e.charNumber+=n.length+6,h=this.parsePatterns_(e,this.latexStyle.commands(e.currentState,"end"+n))),void 0===h&&(h=new c.CommandToken({name:"end"+n})),i(e,h),e.currentToken=r,s}}}},{key:"parseCommandToken_",value:function(e){var t=e.source.substring(e.position).match(/^\\([\w@]+\*?)/);if(t){e.position+=t[0].length,e.charNumber+=t[0].length;var n=this.parsePatterns_(e,this.latexStyle.commands(e.currentState,t[1]));return void 0===n&&(n=new c.CommandToken({name:t[1]})),n}}},{key:"parseSymbolsToken_",value:function(e){var t=e.source[e.position],n=this.parsePatterns_(e,this.latexStyle.symbols(e.currentState,t));return void 0===n&&(++e.position,++e.charNumber,n=new c.SymbolToken({pattern:t})),n}},{key:"parsePatterns_",value:function(e,t){var n=this,r=e.copy(),o=void 0;return t.some(function(t){return!!(o=n.parsePattern_(e,t))||(r.copy(e),!1)}),o}},{key:"parsePattern_",value:function(e,t){var n=e.currentToken;e.currentToken=t instanceof u.Command?new c.CommandToken({command:t}):new c.SymbolToken({symbol:t});for(var r=t.patternComponents,i=r.length,s=0;s<i;++s){var l=r[s];if((0,f.isNumber)(l)){var p=t.parameter(l),h=r[s+1];if("string"==typeof h){if(this.parseParameterToken_(e,(0,f.mustNotBeUndefined)(p),h)){if(0!==e.source.substring(e.position).indexOf(h))return;e.position+=h.length,e.charNumber+=h.length,++s;continue}}else if(this.parseParameterToken_(e,(0,f.mustNotBeUndefined)(p)))continue}else if((0,f.isString)(l)){for(;o(e););if(0===e.source.substring(e.position).indexOf(l)){e.position+=l.length,e.charNumber+=l.length;continue}}else if(a(e))continue;break}if(!(s<i)){var d=e.currentToken;return e.currentToken=n,e.updateState(t.operations),d}}},{key:"parseUntilLabel_",value:function(e,t,n){for(;0!==e.source.substring(e.position).indexOf(t);){if(e.position>=e.source.length)return!1;this.parseToken_(e)}return!0}}]),e}(),t.Context=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(this,e),this.source=t||"",this.position=0,this.lineNumber=0,this.charNumber=0,this.currentToken=void 0,this.currentState=new l.State,this.stateStack=[],this.comments=[]}return s(e,[{key:"copy",value:function(t){var n=t||new e;return n.source=this.source,n.position=this.position,n.lineNumber=this.lineNumber,n.charNumber=this.charNumber,n.currentToken=this.currentToken,n.currentState=this.currentState.copy(),n.stateStack=this.stateStack.slice(),n.comments=this.comments.slice(),n}},{key:"updateState",value:function(e){var t=this;if(!(e instanceof Array))throw new TypeError('"operations" isn\'t an Array instance');var n={};e.forEach(function(e){switch(e.directive){case l.Directive.BEGIN:switch(e.operand){case l.GROUP:t.currentState.update(n),n={},t.stateStack.push(t.currentState.copy());break;default:n[e.operand]=!0}break;case l.Directive.END:switch(e.operand){case l.GROUP:if(n={},t.stateStack.length<1)throw new Error("state stack is empty");t.currentState=(0,f.mustNotBeUndefined)(t.stateStack.pop());break;default:n[e.operand]=!1}}}),this.currentState.update(n)}}]),e}())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var o=n(1);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(2);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(4);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=n(3);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=n(5);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})}])});
//# sourceMappingURL=latex-parser.min.js.map